{% extends 'base.html' %}

{% block title %}- {{ user.name }}{% endblock %}

{% block content %}

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        // alerta visual pequeno
        const toast = document.createElement("div");
        toast.innerText = "Copiado!";
        toast.className = "copy-toast";
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 1200);
    });
}
</script>

<div class="error">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
</div>

<div class="profiles">
      <div class="profile-card">

            <div class="profile-items">
                  {% if user.photo %}
                        <img src="{{ url_for('static', filename=user.photo) }}" class="profiles-photo" />
                  {% else %}
                        <img src="{{ url_for('static', filename='default.png') }}" alt="Sem foto" class="profiles-photo" >
                  {% endif %}

                  {% if user.name %}
                        <span class="profile-name">
                              {% set parts = user.name.split() %}
                              {% if parts|length >= 2 %}
                                    {{ parts[0] }} {{ parts[-1] }}
                              {% else %}
                                    {{ user.name }}
                              {% endif %}

                              {% if idade %}
                                    ({{ idade }} anos)
                              {% endif %}
                        </span>
                  {% endif %}
            </div>
            
            <div class="profile-items">
                  <p class="profile-info"><strong>Data de Nascimento:</strong> 
                        {% if user.date %}
                              {{ user.date.strftime('%d/%m/%Y') }}
                        {% endif %}
                  </p>
            </div>

            <div class="profile-items">
                  <div class="profile-items" style="display: flex; justify-content: space-between; align-items: center;">
      
                        <p class="profile-info" style="margin: 0;">
                              <strong>Telefone:</strong>
                              {% if user.number %}
                                    <span class="copy-field" onclick="copyToClipboard('{{ user.number }}')">
                                          {{ user.number }}
                                    </span>

                                    <i class="fa fa-copy copy-icon" onclick="copyToClipboard('{{ user.number }}')" title="Copiar"></i>

                                    <a href="https://wa.me/{{ user.number | replace('(', '') | replace(')', '') | replace('-', '') | replace(' ', '') }}"
                                          target="_blank" class="whatsapp-btn">
                                          <i class="fa-brands fa-whatsapp"></i>
                                    </a>
                              {% endif %}
                        </p>

                        <a href="{{ url_for('chat', with_user_id=user.id) }}" 
                              class="btn btn-primary rounded-pill d-flex align-items-center gap-2">
                              <i class="fa fa-envelope"></i> Uchat
                        </a>
                  </div>
            </div>

            <div class="profile-items"> 
                  <p class="profile-info"><strong>E-mail:</strong>
                        {% if user.email %}
                              <span class="copy-field" onclick="copyToClipboard('{{ user.email }}')">
                                    {{ user.email }}
                              </span>

                              <i class="fa fa-copy copy-icon" onclick="copyToClipboard('{{ user.email }}')" title="Copiar"></i>
                        {% endif %}
                  </p>
            </div>

            <div class="profile-items">
                  <p class="profile-info"><strong>Biografia:</strong>
                  {% if user.bio %}
                        {{ user.bio }}
                  {% endif %}
                  </p>
            </div>
      </div>
</div>

{% endblock %}